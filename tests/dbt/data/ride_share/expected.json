[
  {
    "documentation": {
      "datasetDocumentations": [],
      "fieldDocumentations": [
        {
          "documentation": "Duration of the bike trip in seconds.",
          "fieldPath": "duration"
        }
      ]
    },
    "logicalId": {
      "account": "metaphor",
      "name": "demo_db.metaphor.cycle_hire",
      "platform": "SNOWFLAKE"
    }
  },
  {
    "documentation": {
      "datasetDocumentations": [],
      "fieldDocumentations": []
    },
    "logicalId": {
      "account": "metaphor",
      "name": "demo_db.metaphor.cycle_stations",
      "platform": "SNOWFLAKE"
    }
  },
  {
    "dbtModel": {
      "docsUrl": "http://localhost:8080/#!/model/model.london_bike_analysis.rides_by_month_2017",
      "fields": [],
      "materialization": {
        "targetDataset": "DATASET~EE13285BEF98BF5E00F0C747132B9960",
        "type": "TABLE"
      },
      "packageName": "london_bike_analysis",
      "rawSql": "WITH stations AS (\r\n\r\n    SELECT *\r\n    FROM {{ ref('raw_bike_stations') }}\r\n\r\n),\r\n\r\nrides AS (\r\n\r\n    SELECT *\r\n    FROM {{ ref('cleaned_bike_rides') }}\r\n\r\n),\r\n\r\nstart_stat_join AS (\r\n\r\n    SELECT rides.*\r\n    , stations.bikes_count as start_station_bikes_count\r\n    , stations.docks_count as start_station_docks_count\r\n    , stations.install_date as start_station_install_date\r\n    FROM rides\r\n    LEFT JOIN stations\r\n    ON rides.start_station_id = stations.id\r\n)\r\n\r\nSELECT \r\n    total_minutes \r\n    , total_bike_hires \r\n    , average_duration \r\n    , month \r\n    , start_peak_travel\r\n    , same_station_flag\r\n    , start_station_id\r\n    , start_station_name\r\n    , start_station_bikes_count \r\n    , start_station_docks_count \r\n    , start_station_install_date \r\n    , end_station_id\r\n    , end_station_name\r\n    , stations.bikes_count as end_station_bikes_count\r\n    , stations.docks_count as end_station_docks_count\r\n    , stations.install_date as end_station_install_date\r\nFROM start_stat_join\r\nLEFT JOIN stations\r\nON start_stat_join.end_station_id = stations.id",
      "sourceDatasets": [],
      "sourceModels": [
        "VIRTUAL_VIEW~BEABE1FF13F4749A5287A0C3AB91A51C",
        "VIRTUAL_VIEW~E2AC9FA16880683393FEF02E8AE6F087"
      ],
      "tags": [],
      "url": "https://github.com/MetaphorData/dbt/tree/main/ride_share/models/rides/rides_by_month_2017.sql"
    },
    "entityUpstream": {
      "sourceEntities": [
        "VIRTUAL_VIEW~BEABE1FF13F4749A5287A0C3AB91A51C",
        "VIRTUAL_VIEW~E2AC9FA16880683393FEF02E8AE6F087"
      ]
    },
    "logicalId": {
      "name": "london_bike_analysis.rides_by_month_2017",
      "type": "DBT_MODEL"
    },
    "structure": {
      "directories": [
        "london_bike_analysis"
      ],
      "name": "rides_by_month_2017"
    }
  },
  {
    "dbtModel": {
      "description": "This table contains a transformed version of the raw_bike_hires table, which includes additional calculated fields such as creating a duration in minutes field.  Each ride has been aggregated so any journey that starts and ends at the same station, in the same month and roughly time of day are  aggregated together to get the total minutes similar journeys have taken.\n",
      "docsUrl": "http://localhost:8080/#!/model/model.london_bike_analysis.cleaned_bike_rides",
      "fields": [
        {
          "description": "The total minutes of a particular journey in a month and general time of day.",
          "fieldName": "total_minutes",
          "fieldPath": "total_minutes",
          "nativeType": "Not Set",
          "tags": []
        },
        {
          "description": "Total number of bike hires of the same journey in a particular month and time of day",
          "fieldName": "total_bike_hires",
          "fieldPath": "total_bike_hires",
          "nativeType": "Not Set",
          "tags": []
        },
        {
          "description": "Month the bike hire was in",
          "fieldName": "month",
          "fieldPath": "month",
          "nativeType": "Not Set",
          "tags": []
        },
        {
          "description": "",
          "fieldName": "start_peak_travel",
          "fieldPath": "start_peak_travel",
          "nativeType": "Not Set",
          "tags": []
        },
        {
          "description": "",
          "fieldName": "same_station_flag",
          "fieldPath": "same_station_flag",
          "nativeType": "Not Set",
          "tags": []
        },
        {
          "description": "",
          "fieldName": "start_station_name",
          "fieldPath": "start_station_name",
          "nativeType": "Not Set",
          "tags": []
        }
      ],
      "materialization": {
        "targetDataset": "DATASET~20C7C3A6025292FE2E75A471C31657F9",
        "type": "TABLE"
      },
      "packageName": "london_bike_analysis",
      "rawSql": "-- Adding extra fields including if the bike was rented during peak time \r\nSELECT\r\n    SUM(duration_minutes) as total_minutes\r\n    , COUNT(rental_id) as total_bike_hires\r\n    , ROUND(SUM(duration_minutes) / COUNT(rental_id), 2) AS average_duration\r\n    , EXTRACT(month from start_date) as month\r\n    , CASE\r\n        WHEN EXTRACT(HOUR from TO_TIMESTAMP(start_date)) >= 6 AND EXTRACT(HOUR from TO_TIMESTAMP(start_date)) <= 10 THEN 'Morning Peak'\r\n        WHEN EXTRACT(HOUR from TO_TIMESTAMP(start_date)) >= 16 AND EXTRACT(HOUR from TO_TIMESTAMP(start_date)) <= 19 THEN 'Evening Peak'\r\n        ELSE 'Off-Peak'\r\n      END AS start_peak_travel\r\n    , IFF(start_station_id = end_station_id, True, False) as same_station_flag\r\n    , start_station_id\r\n    , start_station_name\r\n    , end_station_id\r\n    , end_station_name\r\nFROM {{ ref('raw_bike_hires') }}\r\nGROUP BY 4,5,6,7,8,9,10\r\nORDER BY total_minutes DESC",
      "sourceDatasets": [],
      "sourceModels": [
        "VIRTUAL_VIEW~AB431420AAB09A0DC1E238C1D2A8A423"
      ],
      "tags": [],
      "tests": [
        {
          "columns": [
            "total_minutes"
          ],
          "dependsOnMacros": [
            "macro.dbt.test_not_null"
          ],
          "name": "not_null_cleaned_bike_rides_total_minutes",
          "uniqueId": "test.london_bike_analysis.not_null_cleaned_bike_rides_total_minutes.1c7c80a2d6"
        },
        {
          "columns": [
            "total_minutes"
          ],
          "dependsOnMacros": [
            "macro.dbt_utils.test_at_least_one",
            "macro.dbt.get_where_subquery"
          ],
          "name": "dbt_utils_at_least_one_cleaned_bike_rides_total_minutes",
          "uniqueId": "test.london_bike_analysis.dbt_utils_at_least_one_cleaned_bike_rides_total_minutes.8432437e46"
        },
        {
          "columns": [
            "total_bike_hires"
          ],
          "dependsOnMacros": [
            "macro.dbt.test_not_null"
          ],
          "name": "not_null_cleaned_bike_rides_total_bike_hires",
          "uniqueId": "test.london_bike_analysis.not_null_cleaned_bike_rides_total_bike_hires.848927fb8f"
        },
        {
          "columns": [
            "total_bike_hires"
          ],
          "dependsOnMacros": [
            "macro.dbt_utils.test_at_least_one",
            "macro.dbt.get_where_subquery"
          ],
          "name": "dbt_utils_at_least_one_cleaned_bike_rides_total_bike_hires",
          "uniqueId": "test.london_bike_analysis.dbt_utils_at_least_one_cleaned_bike_rides_total_bike_hires.db70dcef4a"
        },
        {
          "columns": [
            "month"
          ],
          "dependsOnMacros": [
            "macro.dbt.test_not_null"
          ],
          "name": "not_null_cleaned_bike_rides_month",
          "uniqueId": "test.london_bike_analysis.not_null_cleaned_bike_rides_month.e937c898a1"
        },
        {
          "columns": [
            "month"
          ],
          "dependsOnMacros": [
            "macro.dbt_utils.test_at_least_one",
            "macro.dbt.get_where_subquery"
          ],
          "name": "dbt_utils_at_least_one_cleaned_bike_rides_month",
          "uniqueId": "test.london_bike_analysis.dbt_utils_at_least_one_cleaned_bike_rides_month.909766ad33"
        },
        {
          "columns": [
            "start_peak_travel"
          ],
          "dependsOnMacros": [
            "macro.dbt.test_accepted_values",
            "macro.dbt.get_where_subquery"
          ],
          "name": "accepted_values_cleaned_bike_rides_start_peak_travel__Evening_Peak__Off_Peak__Morning_Peak",
          "uniqueId": "test.london_bike_analysis.accepted_values_cleaned_bike_rides_start_peak_travel__Evening_Peak__Off_Peak__Morning_Peak.014130c1a3"
        },
        {
          "columns": [
            "same_station_flag"
          ],
          "dependsOnMacros": [
            "macro.dbt.test_not_null"
          ],
          "name": "not_null_cleaned_bike_rides_same_station_flag",
          "uniqueId": "test.london_bike_analysis.not_null_cleaned_bike_rides_same_station_flag.6293c4e2a8"
        },
        {
          "columns": [
            "start_station_name"
          ],
          "dependsOnMacros": [
            "macro.dbt.test_not_null"
          ],
          "name": "not_null_cleaned_bike_rides_start_station_name",
          "uniqueId": "test.london_bike_analysis.not_null_cleaned_bike_rides_start_station_name.4eec63218d"
        }
      ],
      "url": "https://github.com/MetaphorData/dbt/tree/main/ride_share/models/rides/cleaned_bike_rides.sql"
    },
    "entityUpstream": {
      "sourceEntities": [
        "VIRTUAL_VIEW~AB431420AAB09A0DC1E238C1D2A8A423"
      ]
    },
    "logicalId": {
      "name": "london_bike_analysis.cleaned_bike_rides",
      "type": "DBT_MODEL"
    },
    "structure": {
      "directories": [
        "london_bike_analysis"
      ],
      "name": "cleaned_bike_rides"
    }
  },
  {
    "dbtModel": {
      "docsUrl": "http://localhost:8080/#!/model/model.london_bike_analysis.rides_by_month_start_station_2017",
      "fields": [],
      "materialization": {
        "targetDataset": "DATASET~5CA009811196DF4C6E5CCBA94E99B437",
        "type": "TABLE"
      },
      "packageName": "london_bike_analysis",
      "rawSql": "SELECT \r\n    SUM(total_minutes) AS total_minutes\r\n    , ROUND(SUM(total_minutes) / 60 ,2) AS total_hours\r\n    , SUM(total_bike_hires) AS total_bike_hires\r\n    , ROUND(SUM(total_minutes) / SUM(total_bike_hires), 2) AS average_duration_in_minutes\r\n    , month\r\n    , start_peak_travel\r\n    , same_station_flag\r\n    , start_station_id\r\n    , start_station_name\r\n    , start_station_bikes_count\r\n    , start_station_docks_count\r\n    , start_station_install_date\r\nFROM {{ ref('rides_by_month_2017') }}\r\nGROUP BY 5,6,7,8,9,10,11,12\r\nORDER BY total_bike_hires DESC",
      "sourceDatasets": [],
      "sourceModels": [
        "VIRTUAL_VIEW~C7AD0F50959B4A41901E513EB19B2592"
      ],
      "tags": [],
      "url": "https://github.com/MetaphorData/dbt/tree/main/ride_share/models/rides/rides_by_month_start_station_2017.sql"
    },
    "entityUpstream": {
      "sourceEntities": [
        "VIRTUAL_VIEW~C7AD0F50959B4A41901E513EB19B2592"
      ]
    },
    "logicalId": {
      "name": "london_bike_analysis.rides_by_month_start_station_2017",
      "type": "DBT_MODEL"
    },
    "structure": {
      "directories": [
        "london_bike_analysis"
      ],
      "name": "rides_by_month_start_station_2017"
    }
  },
  {
    "dbtModel": {
      "description": "This table contains all bike hires in London in 2017. This is the raw dataset so no cleaning or transformation.",
      "docsUrl": "http://localhost:8080/#!/model/model.london_bike_analysis.raw_bike_hires",
      "fields": [],
      "materialization": {
        "targetDataset": "DATASET~D8451F8FD7C62A5AB484C9C9C9131604",
        "type": "TABLE"
      },
      "packageName": "london_bike_analysis",
      "rawSql": "SELECT \r\n    rental_id\r\n    , duration as duration_seconds\r\n    , duration / 60 as duration_minutes\r\n    , bike_id\r\n    , start_date\r\n    , start_station_id\r\n    , start_station_name\r\n    , end_date\r\n    , end_station_id\r\n    , end_station_name\r\nFROM  {{ source('metaphor', 'cycle_hire') }}\r\nWHERE EXTRACT(year from start_date) = 2017",
      "sourceDatasets": [
        "DATASET~0BF8A8A87FD2B76DDAA0E3339E0C3D73"
      ],
      "sourceModels": [],
      "tags": [],
      "tests": [
        {
          "columns": [],
          "dependsOnMacros": [
            "macro.dbt_utils.test_fewer_rows_than",
            "macro.dbt.get_where_subquery"
          ],
          "name": "dbt_utils_fewer_rows_than_raw_bike_hires_ref_raw_bike_stations_",
          "uniqueId": "test.london_bike_analysis.dbt_utils_fewer_rows_than_raw_bike_hires_ref_raw_bike_stations_.ffa7ccfb39"
        }
      ],
      "url": "https://github.com/MetaphorData/dbt/tree/main/ride_share/models/rides/raw_bike_hires.sql"
    },
    "entityUpstream": {
      "sourceEntities": [
        "DATASET~0BF8A8A87FD2B76DDAA0E3339E0C3D73"
      ]
    },
    "logicalId": {
      "name": "london_bike_analysis.raw_bike_hires",
      "type": "DBT_MODEL"
    },
    "structure": {
      "directories": [
        "london_bike_analysis"
      ],
      "name": "raw_bike_hires"
    }
  },
  {
    "dbtModel": {
      "description": "This table contains all bike stations in the London area. This only includes stations intalled before January 1, 2017 and doesn't include stations that were removed in 2017 (before Jan 1 2018). This is the raw data so no cleaning or transformation.",
      "docsUrl": "http://localhost:8080/#!/model/model.london_bike_analysis.raw_bike_stations",
      "fields": [
        {
          "description": "Primary Key",
          "fieldName": "id",
          "fieldPath": "id",
          "nativeType": "Not Set",
          "tags": []
        }
      ],
      "materialization": {
        "targetDataset": "DATASET~1C7EA918847E87EA732164D190C7C360",
        "type": "TABLE"
      },
      "packageName": "london_bike_analysis",
      "rawSql": "SELECT \r\n    id\r\n    , name as station_name\r\n    , bikes_count\r\n    , docks_count\r\n    , install_date\r\n    , removal_date\r\nFROM  {{ source('metaphor', 'cycle_stations') }}\r\nWHERE install_date < '2017-01-01' and (removal_date < '2018-01-01' or removal_date is null)",
      "sourceDatasets": [
        "DATASET~DC0498D11FBD059730F0454C60B616D2"
      ],
      "sourceModels": [],
      "tags": [],
      "url": "https://github.com/MetaphorData/dbt/tree/main/ride_share/models/rides/raw_bike_stations.sql"
    },
    "entityUpstream": {
      "sourceEntities": [
        "DATASET~DC0498D11FBD059730F0454C60B616D2"
      ]
    },
    "logicalId": {
      "name": "london_bike_analysis.raw_bike_stations",
      "type": "DBT_MODEL"
    },
    "structure": {
      "directories": [
        "london_bike_analysis"
      ],
      "name": "raw_bike_stations"
    }
  },
  {
    "dbtModel": {
      "compiledSql": "\n\n\nselect * from DEMO_DB.metaphor.cycle_hire",
      "docsUrl": "http://localhost:8080/#!/model/snapshot.london_bike_analysis.cycle_hire_snapshot",
      "fields": [],
      "materialization": {
        "targetDataset": "DATASET~1CEB15D02D74BEDC339C432071BD0940",
        "type": "SNAPSHOT"
      },
      "packageName": "london_bike_analysis",
      "rawSql": "\n{{\n    config(\n      target_schema='snapshots',\n      strategy='check',\n      unique_key='bike_id',\n      check_cols=['start_date', 'end_date']\n    )\n}}\n\nselect * from {{ source('metaphor', 'cycle_hire') }}\n",
      "sourceDatasets": [
        "DATASET~0BF8A8A87FD2B76DDAA0E3339E0C3D73"
      ],
      "sourceModels": [],
      "tags": [],
      "url": "https://github.com/MetaphorData/dbt/tree/main/ride_share/snapshots/cycle_hire_snapshot.sql"
    },
    "entityUpstream": {
      "sourceEntities": [
        "DATASET~0BF8A8A87FD2B76DDAA0E3339E0C3D73"
      ]
    },
    "logicalId": {
      "name": "london_bike_analysis.cycle_hire_snapshot",
      "type": "DBT_MODEL"
    },
    "structure": {
      "directories": [
        "london_bike_analysis"
      ],
      "name": "cycle_hire_snapshot"
    }
  }
]
